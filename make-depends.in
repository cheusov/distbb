#!/bin/sh

#
# run 'make depends' with changed DEPENDS and BUILD_DEPENDS.
# Alternative dependencies are removed.
#

# $1 - enriched pkgpath

set -e

export PATH=@@bindir@@:$PATH

if test -z "$PKG_ADD"; then
	echo 'PKG_ADD must be set' 1>&2
	exit 1
fi

if test -z "$PACKAGES"; then
	echo 'PACKAGES must be set' 1>&2
	exit 1
fi

if test -z "$aux_reqd_deps_fn"; then
	echo '$aux_reqd_deps_fn must be set' 1>&2
	exit 1
fi

if test -z "$aux_pkg_src_summary_fn"; then
	echo '$aux_pkg_src_summary_fn must be set' 1>&2
	exit 1
fi

test $# -eq 1

get_deps (){
    @@libexecdir@@/get_direct_pkgname_deps "$1" \
	"$aux_reqd_deps_fn" \
	"$aux_pkg_src_summary_fn"
}

export PKG_PATH="${PACKAGES}/All"

pkgs_deps=`get_deps $1`
echo 'Packages to install:'
for p in $pkgs_deps; do
    echo " $p"
done
echo ''

echo 'Installing'
for p in $pkgs_deps; do
    $PKG_ADD -I -u "$PACKAGES/All/$p$PKG_SUFX"
done
