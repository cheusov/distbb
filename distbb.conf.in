#-*-mode:  sh -*-

# 
PKGSRC_PREFIX="/usr/pkg"

# pkgsrc friendly make
BMAKE=/usr/bin/make       # for NetBSD
#BMAKE=$PKGSRC_PREFIX/bin/bmake # for other OS

# pkgsrc prefix
PKGSRCDIR=/usr/pkgsrc

# directories to be deleted before installing bootstrap
# and building a package
RMDIRS_CMD="/bin/rm -rf $PKGSRC_PREFIX /var/db/pkg"

# bootstrap
BOOTSTRAP="/path/to/bootstrap.tar.gz"
#BOOTSTRAP=''

# a programs that outputs ALL packages to be built,
# by default all pkgsrc packages are output
LIST_ALL_PKGS_CMD='@@bindir@@/pkg_list_all_pkgs'
#LIST_ALL_PKGS_CMD='( @@bindir@@/pkg_list_all_pkgs; cat my_extra_wip_packages )'

#
EXTRACT_BOOTSTRAP_CMD="/bin/tar -xzf $BOOTSTRAP -C /"

# dorectory for binary packages
PACKAGES="$PKGSRCDIR/packages"

# pkg_summary(5)
PKG_SUMMARY="$PACKAGES/All/pkg_summary.txt"
PKG_UPDATE_SUMMARY_CMD='@@bindir@@/pkg_update_summary'
#PKG_UPDATE_SUMMARY_CMD='@@bindir@@/pkg_update_summary -r'

# pkg_src_summary (similar to pkg_summary(5) but for source packages)
PKG_SRC_SUMMARY="$PKGSRCDIR/pkg_src_summary.txt"
PKG_UPDATE_SRC_SUMMARY_CMD='@@bindir@@/pkg_update_src_summary'
# if your machine is very fast, you can use pkg_src_summary to build
# src_summary from scratch. See below for PSS_* variables
#PKG_UPDATE_SRC_SUMMARY_CMD='@@bindir@@/pkg_src_summary'
# Build partial src_summary, only necessary fields are included.
#PKG_UPDATE_SRC_SUMMARY_CMD='@@bindir@@/pkg_update_src_summary -i "PKGNAME PKGPATH DEPENDS BUILD_DEPENDS"'
# Partial src_summary built from scratch
#PKG_UPDATE_SRC_SUMMARY_CMD='@@bindir@@/pkg_src_summary -f "PKGNAME PKGPATH DEPENDS BUILD_DEPENDS"'

# if you want to build src_summary using several processes or several
# machines in a network, set PSS_SLAVES to non-empty string.
# See pkg_src_summary(1) for details
#    (hint: pkg_src_summary is called by pkg_update_src_summary
#           and pkg_micro_src_summary).
# All variables in this section MUST be exported.
#export PSS_SLAVES=+6 # 6 parallel local processes (for 4-CPU SMP machine)
#export PSS_SLAVES='root@host1 root@host1 root@host2 root@host2 root@host3 root@host3'
#export PSS_TRANSPORT='' # (for SMP machine)
#export PSS_TRANSPORT='/usr/bin/ssh'
#export PSS_PPERS=20 # to process N packages per slave at once
# (max_package_name_length+1) * PSS_PPERS + 1 must be less than PAEXEC_BUFSIZE
#export PAEXEC_BUFSIZE=20480, see paexec(1)

# directory where reports are saved
REPORTS_DIR=$HOME/bulk-logs

# 
PKG_SUFX=.tgz
#PKG_SUFX=.tbz

# install the following package first.
# !!!DIRTY HACK!!!
EXTRA_DEPS='pkgtools/digest'

# for target 'depends'
DEPENDS_TARGET='do-bin-install'
# the following is for USE_DESTDIR=full bulk builds
#DEPENDS_TARGET='real-package-install'

# the following targets will be run in order
TARGETS='depends fetch checksum configure build install package deinstall'
# the following is for USE_DESTDIR=yes|full
#TARGETS='depends fetch checksum configure build package bin-install deinstall'
#TARGETS='depends fetch checksum configure build package package-install package-deinstall'

# extra options passed to bmake
# BATCH is mandatory for bulk builds!
EXTRA_OPTS='BATCH=yes PKG_VERBOSE=1'
# the following is for USE_DESTDIR=full bulk builds
#EXTRA_OPTS='BATCH=yes PKG_VERBOSE=1 USE_DESTDIR=full CHECK_SHLIBS=no'

# set it to non-empty string if you want "distributed" bulk build
# also see SLAVES variable
MASTER_MODE='yes'
#MASTER_MODE='' # for single-host building

# hosts|chroots where actual builds are done
SLAVES='root@host1 root@host2 root@host3'
#SLAVES='pkgsrc@host1 pkgsrc@host2 pkgsrc@host3'
#SLAVES='chroot1 chroot2 chroot3'

# transport to the slaves
TRANSPORT='/usr/bin/ssh -x'
#TRANSPORT="distbb_chroot @@prefix@@/bin/distbb"

# do not change the following unless you know what you are doing
DISTBB_SLAVE=@@libexecdir@@/slave
DISTBB_LOCK=@@libexecdir@@/lock

# filename containing notes about bulk build (in html format),
# e.g. unusual build options, compiler etc.
NOTES=''

# Person running bulk build (in html format).
# If empty string, it is not included to the report.
RESPONSIBLE=''
#RESPONSIBLE='Aleksey Cheusov'
#RESPONSIBLE='Aleksey Cheusov &lt;cheusov@tut.by&gt;'
#RESPONSIBLE='<a href="mailto:cheusov@tut.by">Aleksey Cheusov</a>'

# a number of "top offenders"
OFFENDERS_CNT=20

# a number of failed dependancies that are included to the report
MAX_FAILED_DEPS_CNT=6

#
OS="$(uname -s)"

#
OSVER="$(uname -r)/$(uname -m)"

#
PKGSRCVER='2008Q1'
#PKGSRCVER='current'

#
PACKAGES_URL="http://mova.org/~cheusov/pub/pkgsrc-distbb/$OS/$PKGSRCVER/packages/"

#
REPORT_URL="http://www.mova.org/~cheusov/pub/pkgsrc-distbb/$OS/$PKGSRCVER/log/$BUILD_ID/META/report.html"

#
REPORT_CMD="/usr/bin/mail -s \"pkgsrc-$PKGSRCVER $OS $OSVER bulk build results $BUILD_ID\" cheusov@tut.by"

#
UPLOAD_PKGS_CMD="@@bindir@@/rsync -av --delete-excluded -e ssh $PACKAGES/ cheusov@mova.org:~/public_html/pub/pkgsrc-distbb/$OS/$PKGSRCVER/packages/"

#
UPLOAD_LOGS_CMD="@@bindir@@/rsync -av --delete-excluded --exclude '*.tmp' -e ssh $REPORTS_DIR/$BUILD_ID cheusov@mova.org:~/public_html/pub/pkgsrc-distbb/$OS/$PKGSRCVER/log/"
