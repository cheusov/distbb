#-*-mode:  sh -*-

# pkgsrc friendly make
BMAKE=/usr/bin/make       # for NetBSD
#BMAKE=/usr/pkg/bin/bmake # for other OS

# pkgsrc prefix
PKGSRCDIR=/usr/pkgsrc

# 
PKGSRC_PREFIX="/usr/pkg"

# directories to be deleted before installing bootstrap
# and building a package
RMDIRS_CMD="/bin/rm -rf $PKGSRC_PREFIX /var/db/pkg"

# bootstrap
BOOTSTRAP="/path/to/bootstrap.tar.gz"
#BOOTSTRAP=''

#
EXTRACT_BOOTSTRAP_CMD="@@bindir@@/pax -r -pe -z -f $BOOTSTRAP"

# dorectory for binary packages
PACKAGES=$PKGSRCDIR/packages

# pkg_summary(5)
PKG_SUMMARY=$PACKAGES/All/pkg_summary.txt
PKG_UPDATE_SUMMARY_CMD=@@bindir@@/pkg_update_summary

# pkgsrc_src_summary (similar to pkg_summary(5) but for source packages)
PKG_SRC_SUMMARY=$PKGSRCDIR/pkg_src_summary.txt
PKG_UPDATE_SRC_SUMMARY_CMD=@@bindir@@/pkg_update_src_summary

# directory where reports are saved
REPORTS_DIR=$HOME/bulk-logs

# 
PKG_SUFX=.tgz
#PKG_SUFX=.tbz

# install the following packages first.
# Be VERY accurate in setting this.
# Only "lowest-level packages are allowed here.
EXTRA_DEPS='pkgtools/digest sysutils/checkperms'
#EXTRA_DEPS="$(cd $PKGSRCDIR/devel/bmake && $BMAKE show-var VARNAME=BOOTSTRAP_DEPENDS | sed 's,[^ ]*[.][.]/[.][.]/,,g')"
#EXTRA_DEPS=''

# for target 'depends'
DEPENDS_TARGET='do-bin-install'
# the following is for USE_DESTDIR=full bulk builds
#DEPENDS_TARGET='real-package-install'

# the following targets will be run in order
TARGETS='depends fetch checksum configure build install package deinstall'
# the following is for USE_DESTDIR=yes|full
#TARGETS='depends fetch checksum configure build package bin-install deinstall'
#TARGETS='depends fetch checksum configure build package package-install package-deinstall'

# extra options passed to bmake
# BATCH is mandatory for bulk builds!
EXTRA_OPTS='BATCH=yes PKG_VERBOSE=1'
# the following is for USE_DESTDIR=full bulk builds
#EXTRA_OPTS='BATCH=yes PKG_VERBOSE=1 USE_DESTDIR=full CHECK_SHLIBS=no'

# set it to non-empty string if you want "distributed" bulk build
# also see SLAVES variable
MASTER_MODE='yes'
#MASTER_MODE='' # for single-host building

# hosts|chroots where actual builds are done
SLAVES='root@host1 root@host2 root@host3'
#SLAVES='pkgsrc@host1 pkgsrc@host2 pkgsrc@host3'
#SLAVES='chroot1 chroot2 chroot3'

# transport to the slaves
TRANSPORT='/usr/bin/ssh -x'
#TRANSPORT="distbb_chroot @@prefix@@/bin/distbb"

# do not change the following unless you know what you are doing
DISTBB_SLAVE=@@libexecdir@@/slave
DISTBB_LOCK=@@libexecdir@@/lock

# filename containing notes about bulk build (in html format),
# e.g. unusual build options, compiler etc.
NOTES=''

# a number of "top offenders"
OFFENDERS_CNT=20

#
OS="$(uname -s)"

#
OSVER="$(uname -r)/$(uname -m)"

#
PKGSRCVER='2008Q1'
#PKGSRCVER='current'

#
PACKAGES_URL="http://mova.org/~cheusov/pub/pkgsrc-distbb/$OS/$PKGSRCVER/packages/"

#
REPORT_URL="http://www.mova.org/~cheusov/pub/pkgsrc-distbb/$OS/$PKGSRCVER/log/$BUILD_START/META/report.html"

#
REPORT_CMD="/usr/bin/mail -s \"pkgsrc-$PKGSRCVER $OS $OSVER bulk build results $BUILD_START\" cheusov@tut.by"

#
UPLOAD_PKGS_CMD="@@bindir@@/rsync -av --delete-excluded -e ssh $PACKAGES/ cheusov@mova.org:~/public_html/pub/pkgsrc-distbb/$OS/$PKGSRCVER/packages/"

#
UPLOAD_LOGS_CMD="@@bindir@@/rsync -av --delete-excluded --exclude '*.tmp' -e ssh $REPORTS_DIR/$BUILD_START cheusov@mova.org:~/public_html/pub/pkgsrc-distbb/$OS/$PKGSRCVER/log/"
