#!/bin/sh

set -e
. pipestatus

######################################################################

header (){
    printf ' --**--**-- %8s --**--**--\n' "$1"
}

######################################################################

build_package (){
    for t in $TARGETS; do
	header build
	awk 'BEGIN {for (i=0; i < 1000; ++i) {print "zzzz", i} }'
	echo "stage $t...done"
	sleep 1
    done
}

while read pkgpath; do
    if runpipe_re '. 0' build_package '|' uuencode -; then
	echo "status: $pipestatus_1"
    else
	echo "status: 1" # uuencode failed
    fi
    echo '' # end of task
done
