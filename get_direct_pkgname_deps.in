#!/bin/sh

# Copyright (c) 2008-2010 Aleksey Cheusov <vle@gmx.net>
# All rights reserved.
#
# See LICENSE file

######################################################################

# $1 - enriched PKGPATH 
# $2 - file that contains full dependency graph 
# $3 - pkg_src_summary.txt

set -e

test $# -eq 3

trap 'rm -rf $tmpdir' 0 1 2 3 15

tmpdir=`mktemp -d /tmp/distbb.deps.XXXXXX`
if test -z "$tmpdir"; then
    exit 1
fi

awk -v pkgpath="$1" '$2 == pkgpath {print $1}' "$2" > $tmpdir/pkgpaths.txt
pkg_grep_summary -S PKGPATHe $tmpdir/pkgpaths.txt < "$3" |
sed -n 's/^PKGNAME=//p'
